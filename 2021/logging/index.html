<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>logging 日志模块 | ITlubber</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.3.0"></head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a><a href="/about/">About</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2021-07-01T07:45:58.000Z" id="date"> 2021-07-01</time></span><br><span>updated:<time datetime="2021-07-01T08:09:12.173Z" id="updated"> 2021-07-01</time></span></div><h1>logging 日志模块</h1><hr></div><div id="post-content"><h1 id="模块使用"><a href="#模块使用" class="headerlink" title="模块使用"></a>模块使用</h1><h2 id="日志文件及控制台输出"><a href="#日志文件及控制台输出" class="headerlink" title="日志文件及控制台输出"></a>日志文件及控制台输出</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_logger</span>(<span class="hljs-params">log_file</span>):</span><br>    logger = logging.getLogger(log_file)<br>    logger.setLevel(logging.INFO)<br>    fh = logging.FileHandler(log_file)<br>    fh.setLevel(logging.INFO)<br>    ch = logging.StreamHandler()<br>    ch.setLevel(logging.INFO)<br>    formatter = logging.Formatter(<span class="hljs-string">&quot;[ %(asctime)s ][ %(levelname)s ][ %(filename)s:%(funcName)s:%(lineno)d ][ %(message)s ]&quot;</span>)<br>    ch.setFormatter(formatter)<br>    fh.setFormatter(formatter)<br>    logger.addHandler(ch)<br>    logger.addHandler(fh)<br>    <span class="hljs-keyword">return</span> logger<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    logger = get_logger(log_file=<span class="hljs-string">&quot;logs/info.log&quot;</span>)<br>    logger.debug(<span class="hljs-string">&quot;itlubber.art&quot;</span>)<br>    logger.info(<span class="hljs-string">&quot;itlubber.art&quot;</span>)<br>    logger.error(<span class="hljs-string">&quot;itlubber.art&quot;</span>)<br>    logger.critical(<span class="hljs-string">&quot;itlubber.art&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="错误日志隔离"><a href="#错误日志隔离" class="headerlink" title="错误日志隔离"></a>错误日志隔离</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> makedirs<br><span class="hljs-keyword">from</span> os.path <span class="hljs-keyword">import</span> exists<br><span class="hljs-keyword">from</span> logging.handlers <span class="hljs-keyword">import</span> RotatingFileHandler<br><span class="hljs-keyword">from</span> logging <span class="hljs-keyword">import</span> getLogger, StreamHandler, Formatter, DEBUG, INFO, ERROR<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.config_logger_name = <span class="hljs-string">&quot;bert_ner_logger&quot;</span><br>        self.config_log_dir = <span class="hljs-string">&quot;logs&quot;</span><br>        self.config_log_file_dir = &#123;<br>            <span class="hljs-string">&#x27;info&#x27;</span>: <span class="hljs-string">&#x27;logs/info_logs&#x27;</span>,<br>            <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;logs/error_logs&#x27;</span><br>        &#125;<br>        self.config_log_format = &#123;<br>            <span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">&quot;[ %(levelname)s\t%(asctime)s\t%(filename)s &gt; %(funcName)s &gt; %(threadName)s &gt; %(lineno)d ]  %(message)s&quot;</span>,<br>            <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;[ %(levelname)s\t%(asctime)s\t%(filename)s &gt; %(funcName)s &gt; %(threadName)s &gt; %(lineno)d ]  %(message)s&quot;</span><br>        &#125;<br>        self.config_log_split_max_size = <span class="hljs-number">10</span><br>        self.config_log_backup_count = <span class="hljs-number">50</span><br>        self.config_logs_file_name = &#123;<br>            <span class="hljs-string">&#x27;info&#x27;</span>: <span class="hljs-string">&#x27;info_log&#x27;</span>,<br>            <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;error_log&#x27;</span><br>        &#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_handler</span>(<span class="hljs-params">logger_name: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>, log_dir: <span class="hljs-built_in">dict</span> = <span class="hljs-literal">None</span>, filename: <span class="hljs-built_in">dict</span> = <span class="hljs-literal">None</span>, max_size: <span class="hljs-built_in">float</span> = <span class="hljs-literal">None</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                backup_count: <span class="hljs-built_in">int</span> = <span class="hljs-literal">None</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                <span class="hljs-built_in">format</span>: <span class="hljs-built_in">dict</span> = <span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    全局logger函数, 将日常日志和错误日志分开隔离</span><br><span class="hljs-string"></span><br><span class="hljs-string">    :param logger_name:     全局logger的名称, 默认当前运行文件名称 (__name__)</span><br><span class="hljs-string">    :param log_dir:         保存日志的目录字典</span><br><span class="hljs-string">    :param filename:        日志保存文件名称字典,可以不写.log文件后缀名</span><br><span class="hljs-string">    :param max_size:        单个日志文件最大大小，单位 MB ,默认超过 10M 分割日志</span><br><span class="hljs-string">    :param backup_count:    备份日志的数量, 默认备份 20 个日志文件,文件日志大小为 20*10 M</span><br><span class="hljs-string">    :param format:          日志输出的格式, 具体写法参照 logging 官方文档</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 默认值设置</span><br>    default_log_dir = &#123;<span class="hljs-string">&#x27;info&#x27;</span>: <span class="hljs-string">&#x27;data/logs/info_logs&#x27;</span>,<br>                       <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;data/logs/error_logs&#x27;</span>&#125;<br>    default_logger_name = __name__<br>    default_file_name = &#123;<span class="hljs-string">&#x27;info&#x27;</span>: <span class="hljs-string">&#x27;info_log&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;error_log&#x27;</span>&#125;<br>    default_max_size = <span class="hljs-number">10</span><br>    default_backup_count = <span class="hljs-number">20</span><br>    default_format = &#123;<span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">&quot;[ %(asctime)s ][ %(levelname)s ][ %(filename)s:%(funcName)s:%(lineno)d ][ %(message)s ]&quot;</span>,<br>                      <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;[ %(asctime)s ][ %(levelname)s ][ %(filename)s:%(funcName)s:%(lineno)d ][ %(message)s ]&quot;</span>&#125;<br><br>    <span class="hljs-comment"># 处理参数值</span><br>    logger_name = logger_name <span class="hljs-keyword">or</span> default_logger_name<br>    log_dir = log_dir <span class="hljs-keyword">or</span> default_log_dir<br>    filename = filename <span class="hljs-keyword">or</span> default_file_name<br>    max_size = max_size <span class="hljs-keyword">or</span> default_max_size<br>    backup_count = backup_count <span class="hljs-keyword">or</span> default_backup_count<br>    <span class="hljs-built_in">format</span> = <span class="hljs-built_in">format</span> <span class="hljs-keyword">or</span> default_format<br>    max_size = max_size * <span class="hljs-number">1024</span> ** <span class="hljs-number">2</span><br><br>    <span class="hljs-comment"># 创建logger</span><br>    logger = getLogger(logger_name)<br>    logger.setLevel(DEBUG)<br><br>    <span class="hljs-comment"># 创建日志文件夹</span><br>    formatter = &#123;&#125;<br>    log_file_path = &#123;&#125;<br>    rotating_file_handler = &#123;&#125;<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">type</span>, <span class="hljs-built_in">dir</span> <span class="hljs-keyword">in</span> log_dir.items():<br>        <span class="hljs-comment"># 处理 log_file</span><br>        suffix = <span class="hljs-string">&#x27;.log&#x27;</span><br>        filename[<span class="hljs-built_in">type</span>] = filename[<span class="hljs-built_in">type</span>] <span class="hljs-keyword">if</span> filename[<span class="hljs-built_in">type</span>].endswith(suffix) <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(filename[<span class="hljs-built_in">type</span>], suffix)<br>        <span class="hljs-comment"># 处理 log 文件保存目录的路径</span><br>        log_dir[<span class="hljs-built_in">type</span>] = log_dir[<span class="hljs-built_in">type</span>].replace(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;\\&quot;</span> <span class="hljs-keyword">in</span> log_dir[<span class="hljs-built_in">type</span>] <span class="hljs-keyword">else</span> log_dir[<span class="hljs-built_in">type</span>]<br>        log_dir[<span class="hljs-built_in">type</span>] = log_dir[<span class="hljs-built_in">type</span>] <span class="hljs-keyword">if</span> log_dir[<span class="hljs-built_in">type</span>].endswith(<span class="hljs-string">&quot;/&quot;</span>) <span class="hljs-keyword">else</span> log_dir[<span class="hljs-built_in">type</span>] + <span class="hljs-string">&#x27;/&#x27;</span><br>        log_file_path[<span class="hljs-built_in">type</span>] = <span class="hljs-string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(log_dir[<span class="hljs-built_in">type</span>], filename[<span class="hljs-built_in">type</span>])<br>        <span class="hljs-comment"># log_dir[type 目录，如果不存在则创建</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> exists(log_dir[<span class="hljs-built_in">type</span>]):<br>            <span class="hljs-keyword">try</span>:<br>                makedirs(log_dir[<span class="hljs-built_in">type</span>])<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> error:<br>                logger.critical(<span class="hljs-string">&#x27;错误 &gt;&gt; 创建日志目录失败,清手动创建目录文件位置,运行 sudo mkdir -p /applog/&#123;info_logs,error_logs&#125;&#x27;</span>)<br>                logger.critical(<span class="hljs-string">&#x27;错误 &gt;&gt; 报错信息 : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(error))<br>        <span class="hljs-comment"># 日志行格式</span><br>        formatter[<span class="hljs-built_in">type</span>] = Formatter(<span class="hljs-built_in">format</span>[<span class="hljs-built_in">type</span>])<br><br>        rotating_file_handler[<span class="hljs-built_in">type</span>] = RotatingFileHandler(<br>            filename=log_file_path[<span class="hljs-built_in">type</span>], mode=<span class="hljs-string">&#x27;a&#x27;</span>, maxBytes=max_size, backupCount=backup_count, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;info&quot;</span>:<br>            <span class="hljs-comment"># ≥ INFO级别才记录到文件</span><br>            rotating_file_handler[<span class="hljs-built_in">type</span>].setLevel(DEBUG)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;error&quot;</span>:<br>            rotating_file_handler[<span class="hljs-built_in">type</span>].setLevel(ERROR)<br>        rotating_file_handler[<span class="hljs-built_in">type</span>].setFormatter(formatter[<span class="hljs-built_in">type</span>])<br>        logger.addHandler(rotating_file_handler[<span class="hljs-built_in">type</span>])<br><br>    stream_handler = StreamHandler()<br>    stream_handler.setLevel(DEBUG)<br>    stream_handler.setFormatter(formatter[<span class="hljs-string">&#x27;info&#x27;</span>])<br>    logger.addHandler(stream_handler)<br><br>    stream_handler.close()<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> rotating_file_handler.keys():<br>        rotating_file_handler[<span class="hljs-built_in">type</span>].close()<br><br>    <span class="hljs-keyword">return</span> logger<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_logger</span>():</span><br>    config = Config()<br>    __logger = log_handler(<br>        logger_name=config.config_logger_name,<br>        log_dir=config.config_log_file_dir,<br>        filename=config.config_logs_file_name, max_size=config.config_log_split_max_size,<br>        backup_count=config.config_log_backup_count,<br>        <span class="hljs-built_in">format</span>=config.config_log_format<br>    )<br>    <span class="hljs-keyword">return</span> __logger<br><br><br>logger = get_logger()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    logger.info(<span class="hljs-string">&quot;lubber&#x27;s logger.&quot;</span>)<br>    logger.info(<span class="hljs-string">&quot;itlubber.art&quot;</span>)<br></code></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2021/anomaly-detection/index/">孤立森林异常值检测 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/2.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.itlubber</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">4</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">6</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">4</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">模块使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8F%8A%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA"><span class="toc-number">1.1.</span> <span class="toc-text">日志文件及控制台输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E9%9A%94%E7%A6%BB"><span class="toc-number">1.2.</span> <span class="toc-text">错误日志隔离</span></a></li></ol></li></ol></div></div><footer><nobr><span class="text-title">D</span><span class="text-content">2018 to 2021</span></nobr><wbr><nobr><span class="text-title">E</span><span class="text-content">itlubber@gmail.com</span></nobr><wbr><wbr><nobr>ITlubber |&nbsp;<a href="http://itlubber.art">街を守り、人を待ちわびて</a></nobr></footer></aside></main><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>